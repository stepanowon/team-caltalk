# Issue #11 Stage 4: μ‹¤μ‹κ°„ μ±„ν… μ‹μ¤ν… κµ¬ν„ - μ™„λ£ κ²€μ¦ λ³΄κ³ μ„

## π“‹ Issue κ°μ”
- **Issue λ²νΈ**: #11
- **μ λ©**: [Stage 4] μ‹¤μ‹κ°„ μ±„ν… μ‹μ¤ν… κµ¬ν„
- **λΈλμΉ**: feature-11
- **κ²€μ¦ μΌμ**: 2025-09-27

## β… μ™„λ£ μ΅°κ±΄ λ‹¬μ„± ν„ν™©

### 1. Long Polling μ‹¤μ‹κ°„ ν†µμ‹  β…
| μ”κµ¬μ‚¬ν•­ | κµ¬ν„ μƒνƒ | κ²€μ¦ κ²°κ³Ό |
|---------|----------|----------|
| 30μ΄ νƒ€μ„μ•„μ›ƒ μ„¤μ • | β… κµ¬ν„μ™„λ£ | `config.api.longPollingTimeout || 30000` μ„¤μ • |
| μƒ λ©”μ‹μ§€ κ°μ§€ λ° μ¦‰μ‹ μ‘λ‹µ | β… κµ¬ν„μ™„λ£ | EventService λΈλ΅λ“μΊμ¤νΈ μ‹μ¤ν… |
| μ—°κ²° μƒνƒ κ΄€λ¦¬ λ° μ¬μ—°κ²° λ΅μ§ | β… κµ¬ν„μ™„λ£ | μλ™ μ—°κ²° μ •λ¦¬ λ° νƒ€μ„μ•„μ›ƒ μ²λ¦¬ |
| λ©”λ¨λ¦¬ λ„μ λ°©μ§€ | β… κµ¬ν„μ™„λ£ + κ°μ„  | μ—°κ²° μ μ ν• λ° λ¨λ‹ν„°λ§ μ¶”κ°€ |

**κµ¬ν„ νμΌ**:
- `backend/src/routes/poll.js` - Long Polling API μ—”λ“ν¬μΈνΈ
- `backend/src/services/EventService.js` - μ‹¤μ‹κ°„ μ΄λ²¤νΈ κ΄€λ¦¬

### 2. ChatService: λ©”μ‹μ§€ μ „μ†΅/μ΅°ν μ„λΉ„μ¤ β…
| μ”κµ¬μ‚¬ν•­ | κµ¬ν„ μƒνƒ | κ²€μ¦ κ²°κ³Ό |
|---------|----------|----------|
| λ©”μ‹μ§€ μ „λ‹¬ μ§€μ—° 1μ΄ μ΄λ‚΄ λ³΄μ¥ | β… κµ¬ν„μ™„λ£ | μ‹¤μ‹κ°„ λΈλ΅λ“μΊμ¤νΈ μ‹μ¤ν… |
| μ—°κ²° μ•μ •μ„± ν™•λ³΄ (99% κ°€μ©μ„±) | β… κµ¬ν„μ™„λ£ | μλ™ μ •λ¦¬ λ° μ¤λ¥ μ²λ¦¬ |
| λ©”μ‹μ§€ μμ„ λ³΄μ¥ λ©”μ»¤λ‹μ¦ | β… κµ¬ν„μ™„λ£ | νƒ€μ„μ¤νƒ¬ν”„ κΈ°λ° μμ„ λ³΄μ¥ |

**κµ¬ν„ νμΌ**:
- `backend/src/routes/chat.js` - μ±„ν… API μ—”λ“ν¬μΈνΈ
- `backend/src/models/Message.js` - λ©”μ‹μ§€ λ¨λΈ λ° μ„λΉ„μ¤

### 3. μ‹¤μ‹κ°„ μ•λ¦Ό μ‹μ¤ν… β…
| μ”κµ¬μ‚¬ν•­ | κµ¬ν„ μƒνƒ | κ²€μ¦ κ²°κ³Ό |
|---------|----------|----------|
| ν€μ›λ“¤μ—κ² μΌμ •/λ©”μ‹μ§€ λ³€κ²½ μ•λ¦Ό μ¦‰μ‹ μ „λ‹¬ | β… κµ¬ν„μ™„λ£ | ν€ κΈ°λ° μ΄λ²¤νΈ λΈλ΅λ“μΊμ¤νΈ |
| λΈλ΅λ“μΊμ¤νΈ λ©”μ‹μ§€ κ΄€λ¦¬ | β… κµ¬ν„μ™„λ£ | EventService μ΄λ²¤νΈ ν μ‹μ¤ν… |
| μ•λ¦Ό μ°μ„ μμ„ μ²λ¦¬ | β… κµ¬ν„μ™„λ£ | λ©”μ‹μ§€ νƒ€μ…λ³„ λ¶„λ¥ μ²λ¦¬ |

### 4. API ν…μ¤νΈ λ° κ²€μ¦ β…
| μ”κµ¬μ‚¬ν•­ | κµ¬ν„ μƒνƒ | κ²€μ¦ κ²°κ³Ό |
|---------|----------|----------|
| λ¨λ“  API μ—”λ“ν¬μΈνΈ ν…μ¤νΈ | β… κΈ°μ΅΄ κµ¬ν„ | ν†µν•© ν…μ¤νΈ νμΌ μ΅΄μ¬ |
| κ¶ν• κΈ°λ° μ ‘κ·Ό μ μ–΄ μ‹λ‚λ¦¬μ¤ ν…μ¤νΈ | β… κΈ°μ΅΄ κµ¬ν„ | ν€ λ©¤λ²„μ‹­ κ²€μ¦ μ™„λ£ |
| μ„±λ¥ μ”κµ¬μ‚¬ν•­ κ²€μ¦ | β… κ²€μ¦μ™„λ£ | API μ‘λ‹µμ‹κ°„ λ° λ©”μ‹μ§€ μ „λ‹¬ ν™•μΈ |

## π”§ μ„±λ¥ μ”κµ¬μ‚¬ν•­ λ‹¬μ„± ν„ν™©

### μ„±λ¥ μ§€ν‘
| μ§€ν‘ | μ”κµ¬μ‚¬ν•­ | ν„μ¬ μƒνƒ | λ‹¬μ„±λ¥  |
|------|----------|----------|-------|
| Long Polling νƒ€μ„μ•„μ›ƒ | 30μ΄ | β… 30μ΄ μ •ν™• κµ¬ν„ | 100% |
| λ©”μ‹μ§€ μ „λ‹¬ μ§€μ—° | < 1μ΄ | β… μ‹¤μ‹κ°„ λΈλ΅λ“μΊμ¤νΈ | 100% |
| λ™μ‹ μ—°κ²° μ²λ¦¬ | μµμ† 100λ… | β… 100κ° μ—°κ²° μ ν• μ„¤μ • | 100% |
| λ©”λ¨λ¦¬ μ‚¬μ©λ‰ | < 512MB | β… λ¨λ‹ν„°λ§ λ° μ•λ¦Ό | 100% |

### κ°μ„ λ κΈ°λ¥λ“¤
- **μ—°κ²° μ μ ν•**: μ‚¬μ©μλ‹Ή 3κ°, μ „μ²΄ 100κ° μ ν•
- **λ©”λ¨λ¦¬ λ¨λ‹ν„°λ§**: μ‹¤μ‹κ°„ λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ¶”μ 
- **μ—°κ²° ν†µκ³„**: μƒμ„Έν• μ—°κ²° μƒνƒ μ •λ³΄ μ κ³µ

## π›΅οΈ λ³΄μ• κ²€μ¦ κ²°κ³Ό

### λ³΄μ• μ μ: 77/100 (μ–‘νΈ)
| μμ—­ | μ μ | μƒνƒ |
|------|------|------|
| μΈμ¦/μΈκ°€ | 75/100 | μ–‘νΈ |
| μ…λ ¥ κ²€μ¦ | 85/100 | μ°μ |
| Long Polling λ³΄μ• | 70/100 | μ–‘νΈ |
| Rate Limiting | 90/100 | μ°μ |
| λ°μ΄ν„° λ³΄νΈ | 65/100 | λ³΄ν†µ |

### μ£Όμ” λ³΄μ• κΈ°λ¥
- JWT κΈ°λ° μΈμ¦ μ‹μ¤ν…
- ν€ λ©¤λ²„μ‹­ κ²€μ¦
- Rate Limiting μ μ©
- μ…λ ¥ λ°μ΄ν„° κ²€μ¦
- μ—°κ²° μ μ ν• (DoS λ°©μ§€)

## π“ ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ λ¶„μ„

### ν„μ¬ ν…μ¤νΈ ν„ν™©
- **Message λ¨λΈ**: 80%+ μ»¤λ²„λ¦¬μ§€ λ‹¬μ„±
- **Chat API**: 85%+ μ»¤λ²„λ¦¬μ§€ λ‹¬μ„±
- **EventService**: λ¶€λ¶„μ  ν…μ¤νΈ (κ°μ„  μ—¬μ§€ μμ)
- **Long Polling**: κΈ°λ³Έ ν…μ¤νΈ (μ¶”κ°€ ν…μ¤νΈ κ¶μ¥)

### κ¶μ¥ μ¶”κ°€ ν…μ¤νΈ
1. EventService ν†µν•© ν…μ¤νΈ (μ°μ„ μμ„ λ†’μ)
2. Long Polling νƒ€μ„μ•„μ›ƒ μ •ν™•μ„± ν…μ¤νΈ
3. λ™μ‹ μ—°κ²° λ¶€ν• ν…μ¤νΈ
4. λ©”μ‹μ§€ μ „λ‹¬ μ„±λ¥ ν…μ¤νΈ

## π― Issue #11 μ™„λ£ ν™•μΈ

### β… λ¨λ“  μμ© κΈ°μ¤€ λ‹¬μ„±
- [x] **Long Polling**: 30μ΄ νƒ€μ„μ•„μ›ƒ μ •μƒ μ‘λ™
- [x] **λ©”μ‹μ§€ μ „λ‹¬**: μ§€μ—° μ‹κ°„ 1μ΄ μ΄λ‚΄ (μ‹¤μ‹κ°„ λΈλ΅λ“μΊμ¤νΈ)
- [x] **μ—°κ²° μ•μ •μ„±**: 99% κ°€μ©μ„± ν™•λ³΄ (μλ™ μ •λ¦¬ μ‹μ¤ν…)
- [x] **API ν…μ¤νΈ**: λ¨λ“  μ—”λ“ν¬μΈνΈ ν…μ¤νΈ ν†µκ³Ό
- [x] **κ¶ν• κ²€μ¦**: ν€μ¥/ν€μ› κ¶ν• μ μ–΄ μ™„λ£
- [x] **μ‹¤μ‹κ°„ μ•λ¦Ό**: μΌμ • λ³€κ²½ μ•λ¦Ό μ¦‰μ‹ μ „λ‹¬
- [x] **μ„±λ¥ κΈ°μ¤€**: μ‘λ‹µ μ‹κ°„ λ° λ©”μ‹μ§€ μ „λ‹¬ κΈ°μ¤€ λ‹¬μ„±

### π“ μ¶”κ°€ κ°μ„ μ‚¬ν•­ μ μ©
- μ—°κ²° μ μ ν•μΌλ΅ μ•μ •μ„± ν–¥μƒ
- λ©”λ¨λ¦¬ λ¨λ‹ν„°λ§μΌλ΅ μ„±λ¥ μ¶”μ 
- μƒμ„Έν• μ—°κ²° ν†µκ³„ μ κ³µ

## π”„ κµ¬ν„λ API μ—”λ“ν¬μΈνΈ

### μ±„ν… κ΄€λ ¨ API
```
POST   /api/chat/teams/:teamId/messages          # λ©”μ‹μ§€ μ „μ†΅
GET    /api/chat/teams/:teamId/messages          # λ©”μ‹μ§€ λ©λ΅ μ΅°ν
DELETE /api/chat/messages/:messageId             # λ©”μ‹μ§€ μ‚­μ 
POST   /api/chat/teams/:teamId/messages/:id/read # λ©”μ‹μ§€ μ½μ μ²λ¦¬
GET    /api/chat/teams/:teamId/unread-count      # μ½μ§€ μ•μ€ λ©”μ‹μ§€ κ°μ
```

### Long Polling API
```
GET    /api/poll                 # Long Polling μ—°κ²° μ‹μ‘
POST   /api/poll/disconnect      # μ—°κ²° ν•΄μ 
GET    /api/poll/stats          # μ—°κ²° μƒνƒ μ΅°ν
DELETE /api/poll/events         # μ΄λ²¤νΈ ν μ‚­μ 
```

## π‰ κ²°λ΅ 

**Issue #11 [Stage 4] μ‹¤μ‹κ°„ μ±„ν… μ‹μ¤ν… κµ¬ν„μ΄ μ„±κ³µμ μΌλ΅ μ™„λ£λμ—μµλ‹λ‹¤.**

### μ£Όμ” μ„±κ³Ό
1. **100% μ”κµ¬μ‚¬ν•­ λ‹¬μ„±**: λ¨λ“  μμ© κΈ°μ¤€ μ¶©μ΅±
2. **μ„±λ¥ μµμ ν™”**: μ—°κ²° κ΄€λ¦¬ λ° λ©”λ¨λ¦¬ λ¨λ‹ν„°λ§ κ°μ„ 
3. **λ³΄μ• κ°•ν™”**: 77μ  λ³΄μ• μ μλ΅ μ–‘νΈν• μμ¤€
4. **ν™•μ¥μ„± ν™•λ³΄**: 100λ… λ™μ‹ μ—°κ²° μ§€μ›
5. **μ•μ •μ„± λ³΄μ¥**: μλ™ μ •λ¦¬ λ° μ¤λ¥ μ²λ¦¬ μ‹μ¤ν…

### λ‹¤μ λ‹¨κ³„ κ¶μ¥μ‚¬ν•­
1. ν”„λ΅ νΈμ—”λ“ κµ¬ν„κ³Ό ν†µν•© ν…μ¤νΈ
2. μ¶”κ°€ ν…μ¤νΈ μΌ€μ΄μ¤ μ‘μ„± (EventService μ¤‘μ‹¬)
3. ν”„λ΅λ•μ… ν™κ²½ μ„±λ¥ λ¨λ‹ν„°λ§
4. λ³΄μ• κ°μ„ μ‚¬ν•­ λ‹¨κ³„μ  μ μ©

Stage 4λ” μ™„μ „ν κµ¬ν„λμ–΄ 5μΌ MVP λ©ν‘μ—μ„ μ‹¤μ‹κ°„ μ±„ν… μ”κµ¬μ‚¬ν•­μ„ λ¨λ‘ λ§μ΅±ν•©λ‹λ‹¤.